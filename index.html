<!DOCTYPE html>
<html>
<head>
  <title>Blockly Workspace with Code and XML Display</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.2.1/blockly.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.2.1/blocks_compressed.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.2.1/javascript_compressed.js"></script>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <div class="flex">
    <div class="workspace-container section" id="blockly-workspace"></div>
    <div class="output-container">
      <div class="section">
        <h3 style="font-family: 'Roboto', cursive; color: #000000; margin-bottom: 10px;">
          Code Output
          <button onclick="copyText('code-output')">Copy</button>
          <button onclick="downloadText('code-output', 'code_output.js')">Download</button>
        </h3>
        <pre id="code-output" class="code-output"></pre>
      </div>
      <div class="section">
        <h3 style="font-family: 'Roboto', cursive; color: #000000; margin-bottom: 10px;">
          XML Structure
          <button onclick="copyText('xml-output')">Copy</button>
          <button onclick="downloadText('xml-output', 'xml_structure.xml')">Download</button>
        </h3>
        <pre id="xml-output" class="xml-output"></pre>
      </div>
    </div>
  </div>

  <script>
    const toolbox = {
        "kind": "categoryToolbox",
        "contents": [
            {
            "kind": "category",
            "name": "Logic",
            "contents": [
                { "kind": "block", "type": "controls_if" },
                { "kind": "block", "type": "logic_compare" },
                { "kind": "block", "type": "logic_operation" }
            ]
            },
            {
            "kind": "category",
            "name": "Loops",
            "contents": [
                { "kind": "block", "type": "controls_repeat_ext" },
                { "kind": "block", "type": "controls_whileUntil" }
            ]
            }
        ]
    };

    // Initialize Blockly workspace
    var workspace = Blockly.inject('blockly-workspace', {
      toolbox: toolbox,
      scrollbars: true,
      trashcan: true,
      zoom: { controls: true, wheel: true, startScale: 0.85, maxScale: 2, minScale: 0.3, scaleSpeed: 1.2 }
    });

    workspace.addChangeListener(() => {
      updateCodeOutput();
      updateXmlOutput();
    });

    function updateCodeOutput() {
      var code = Blockly.JavaScript.workspaceToCode(workspace);
      document.getElementById('code-output').textContent = code;
    }

    function updateXmlOutput() {
      var xml = Blockly.Xml.workspaceToDom(workspace);
      var xmlText = Blockly.Xml.domToPrettyText(xml);
      document.getElementById('xml-output').textContent = xmlText;
    }

    // Copy function
    function copyText(elementId) {
      const text = document.getElementById(elementId).textContent;
      navigator.clipboard.writeText(text).then(() => alert("Copied!"));
    }

    // Download function
    function downloadText(elementId, filename) {
      const text = document.getElementById(elementId).textContent;
      const blob = new Blob([text], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
    }
  </script>
</body>
</html>

